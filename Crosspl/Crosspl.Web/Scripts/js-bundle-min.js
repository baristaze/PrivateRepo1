var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(c){var a="";var k,h,f,j,g,e,d;var b=0;c=Base64._utf8_encode(c);while(b<c.length){k=c.charCodeAt(b++);h=c.charCodeAt(b++);f=c.charCodeAt(b++);j=k>>2;g=((k&3)<<4)|(h>>4);e=((h&15)<<2)|(f>>6);d=f&63;if(isNaN(h)){e=d=64}else{if(isNaN(f)){d=64}}a=a+this._keyStr.charAt(j)+this._keyStr.charAt(g)+this._keyStr.charAt(e)+this._keyStr.charAt(d)}return a},decode:function(c){var a="";var k,h,f;var j,g,e,d;var b=0;c=c.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(b<c.length){j=this._keyStr.indexOf(c.charAt(b++));g=this._keyStr.indexOf(c.charAt(b++));e=this._keyStr.indexOf(c.charAt(b++));d=this._keyStr.indexOf(c.charAt(b++));k=(j<<2)|(g>>4);h=((g&15)<<4)|(e>>2);f=((e&3)<<6)|d;a=a+String.fromCharCode(k);if(e!=64){a=a+String.fromCharCode(h)}if(d!=64){a=a+String.fromCharCode(f)}}a=Base64._utf8_decode(a);return a},_utf8_encode:function(b){b=b.replace(/\r\n/g,"\n");var a="";for(var e=0;e<b.length;e++){var d=b.charCodeAt(e);if(d<128){a+=String.fromCharCode(d)}else{if((d>127)&&(d<2048)){a+=String.fromCharCode((d>>6)|192);a+=String.fromCharCode((d&63)|128)}else{a+=String.fromCharCode((d>>12)|224);a+=String.fromCharCode(((d>>6)&63)|128);a+=String.fromCharCode((d&63)|128)}}}return a},_utf8_decode:function(a){var b="";var d=0;var e=c1=c2=0;while(d<a.length){e=a.charCodeAt(d);if(e<128){b+=String.fromCharCode(e);d++}else{if((e>191)&&(e<224)){c2=a.charCodeAt(d+1);b+=String.fromCharCode(((e&31)<<6)|(c2&63));d+=2}else{c2=a.charCodeAt(d+1);c3=a.charCodeAt(d+2);b+=String.fromCharCode(((e&15)<<12)|((c2&63)<<6)|(c3&63));d+=3}}}return b}};function GGS4(){return(((1+Math.random())*65536)|0).toString(16).substring(1)}function guidGenerator(){return(GGS4()+GGS4()+"-"+GGS4()+"-"+GGS4()+"-"+GGS4()+"-"+GGS4()+GGS4()+GGS4())}function guidGeneratorNoDash(){return(GGS4()+GGS4()+GGS4()+GGS4()+GGS4()+GGS4()+GGS4()+GGS4())}function getUtcTimeNow(){var a=new Date();return convertToUtcTime(a)}function convertToUtcTime(a){return new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds())}function convertToLocalTime(d){var a=new Date();var e=a.getTimezoneOffset();var c=new Date(d);var b=c.getMinutes();c.setMinutes(b-e);return c}function getCookie(a){var b=new RegExp(a+"=[^;]+","i");if(document.cookie.match(b)){return document.cookie.match(b)[0].split("=")[1]}else{return""}}function setCookie(d,e,f){var c=new Date();var b=parseInt(f)*1000;var a=new Date(c.getTime()+b);document.cookie=d+"="+e+"; expires="+a.toGMTString()+"; path=/"}function isValidEmailAddress(b){var a=new RegExp(/^(("[\w-+\s]+")|([\w-+]+(?:\.[\w-+]+)*)|("[\w-+\s]+")([\w-+]+(?:\.[\w-+]+)*))(@((?:[\w-+]+\.)*\w[\w-+]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][\d]\.|1[\d]{2}\.|[\d]{1,2}\.))((25[0-5]|2[0-4][\d]|1[\d]{2}|[\d]{1,2})\.){2}(25[0-5]|2[0-4][\d]|1[\d]{2}|[\d]{1,2})\]?$)/i);return a.test(b)}function preFetch(a,c){for(var f=0;f<a.length;f++){value=a[f];var e="__preloaded_"+value;var d=getCookie(e);if(d==""){var b=document.getElementById(c);var g=document.createElement("div");g.className=value;b.appendChild(g);setCookie(e,"1",24*60*60)}}}function escapeJsonString(a){return a.replace(/[\"]/g,'\\"').replace(/[\\]/g,"\\\\").replace(/[\/]/g,"\\/").replace(/[\b]/g,"\\b").replace(/[\f]/g,"\\f").replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r").replace(/[\t]/g,"\\t")}function checkFileExt(c,a){if(c){var d=c.replace(/^.*\\/,"");if(d){var b=/[^.]+$/.exec(d);if(b){b=b.toString().toLowerCase();if($.inArray(b,a)>=0){return true}}}}return false}function setCursorPos(a){var b=$(a).val();b=$.trim(b);if(b.length==0){a.setSelectionRange(0,0)}}function sanitizeJsonResponse(b){var a=b;if(a.constructor===String){if(a.indexOf("<pre")>=0){a=$($(a)[0]).html()}a=$.parseJSON(a)}return a}function toLocalDateTime(e){var a=new Date();var d=a.getTimezoneOffset();var c=new Date(e);var b=c.getMinutes();c.setMinutes(b-d);return c}function equateHeights(d,a){var c=0;var b=d.find(a);b.each(function(e,g){var f=$(g).height();if(f>c){c=f}});b.each(function(e,f){$(f).css("min-height",c)})}function isNumber(a){return !isNaN(parseFloat(a))&&isFinite(a)}function isInteger(a){return !isNaN(parseFloat(a))&&isFinite(a)&&(a%1===0)};function refreshFBFriendListOnServer(){$.ajax({url:"svc/rest/friends/refresh",type:"POST",dataType:"json",contentType:"application/json",data:null,success:function(a,b,c){},error:function(){}})}function coverPage_FBAuthStateChanged(j,a,h){if(a=="success"){var e=$(".statusWrp");e.hide();var d=$(".signUpWrp");d.hide();var f=$(".contentWrp");f.show();$(".footer").addClass("footer2");coverPage_GetAlreadyInvitedFriends();if(h){_gaq.push(["_trackEvent","SignupCategory","Facebook","Signup",1,null])}}else{if(a=="server-success"){if(h){refreshFBFriendListOnServer()}}else{if(a=="failure"){if($("#isAuthenticated").text()!="0"){logout(coverPage_FBAuthStateChanged,h)}var i=$(".statusWrp");i.hide();var c=$(".signUpWrp");c.show()}else{if(a=="logout"){setCookie("XAuthToken","",-1);$("#isAuthenticated").text("0");var b=$(".signUpWrp");var g=$(".contentWrp");g.hide();b.show();$(".footer").removeClass("footer2")}}}}}function coverPage_FBServerAuthCompletedSuccessfully(a){setCookie("XAuthToken",a.Token,a.ExpiresInSeconds);$("#isAuthenticated").text(a.OAuthUserId);$("#currentUserName").text(a.UserFriendlyName)}function coverPage_GetAlreadyInvitedFriends(){var a=guidGenerator();var b="svc/rest/friends/invited?rid="+a;$.ajax({url:b,type:"GET",dataType:"json",contentType:"application/json",data:null,success:function(c,d,e){if(d=="success"){if(c.ErrorCode=="0"){__facebookExcludedIds=[];$.each(c.Friends,function(f,g){__facebookExcludedIds.push(g.FacebookId)});$(".invitedResult").text(__facebookExcludedIds.length.toString())}}},error:function(){}})}function coverPage_MarkAsInvited(e){var b=[];for(var a=0;a<e.length;a++){var d={FacebookId:e[a]};b.push(d)}var c=b;var f=JSON.stringify(c);$.ajax({url:"svc/rest/mark/friends/invited",type:"POST",dataType:"json",contentType:"application/json",data:f,success:function(h,i,g){},error:function(){}})}function coverPage_InviteFriends(){FB.ui({method:"apprequests",message:"This is a great idea! Sign up to receive an invitation!",data:"54321"},coverPage_InviteFriendsCallback);return false}function coverPage_InviteFriendsCallback(a){if(a&&a.hasOwnProperty("to")){if(a.to.length>0){__facebookExcludedIds=__facebookExcludedIds.concat(a.to);coverPage_MarkAsInvited(a.to)}$(".invitedResult").text(__facebookExcludedIds.length.toString());$(".invitedStats").effect("highlight",{},3000);$(".skip-link-with-auth").text("Continue")}}function coverPage_DocumentReady(){coverPage_InitFacebookEx();$(".fbSignUp").live("click",function(){signupToFacebook(coverPage_FBAuthStateChanged,coverPage_FBServerAuthCompletedSuccessfully)});$(".cover-page-logout").live("click",function(){logout(coverPage_FBAuthStateChanged,true)});$(".reload").live("click",function(){window.location.reload();return false});$(".logoWrp").live("click",function(){gotoTopics();return false});$(".skip-link").live("click",function(){gotoTopics();return false});$(".invite").live("click",coverPage_InviteFriends);$(".inviteLink").live("click",coverPage_InviteFriends)};var dateFormat=function(){var a=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,b=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,d=/[^-+\dA-Z]/g,c=function(f,e){f=String(f);e=e||2;while(f.length<e){f="0"+f}return f};return function(i,v,q){var g=dateFormat;if(arguments.length==1&&Object.prototype.toString.call(i)=="[object String]"&&!/\d/.test(i)){v=i;i=undefined}i=i?new Date(i):new Date;if(isNaN(i)){throw SyntaxError("invalid date")}v=String(g.masks[v]||v||g.masks["default"]);if(v.slice(0,4)=="UTC:"){v=v.slice(4);q=true}var t=q?"getUTC":"get",l=i[t+"Date"](),e=i[t+"Day"](),j=i[t+"Month"](),p=i[t+"FullYear"](),r=i[t+"Hours"](),k=i[t+"Minutes"](),u=i[t+"Seconds"](),n=i[t+"Milliseconds"](),f=q?0:i.getTimezoneOffset(),h={d:l,dd:c(l),ddd:g.i18n.dayNames[e],dddd:g.i18n.dayNames[e+7],m:j+1,mm:c(j+1),mmm:g.i18n.monthNames[j],mmmm:g.i18n.monthNames[j+12],yy:String(p).slice(2),yyyy:p,h:r%12||12,hh:c(r%12||12),H:r,HH:c(r),M:k,MM:c(k),s:u,ss:c(u),l:c(n,3),L:c(n>99?Math.round(n/10):n),t:r<12?"a":"p",tt:r<12?"am":"pm",T:r<12?"A":"P",TT:r<12?"AM":"PM",Z:q?"UTC":(String(i).match(b)||[""]).pop().replace(d,""),o:(f>0?"-":"+")+c(Math.floor(Math.abs(f)/60)*100+Math.abs(f)%60,4),S:["th","st","nd","rd"][l%10>3?0:(l%100-l%10!=10)*l%10]};return v.replace(a,function(m){return m in h?h[m]:m.slice(1,m.length-1)})}}();dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"};dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};Date.prototype.format=function(a,b){return dateFormat(this,a,b)};function showBlockedConfirmDialog(e,b){var c=getCssForBlockUI("#000");var f=$(".confirm-dialog");var d=f.find(".confirm-dialog-content-inner");var a=f.find(".confirm-dialog-result");d.text(e);a.text("0");$.blockUI({message:f,css:c,overlayCSS:{backgroundColor:"#000",opacity:0.6,cursor:"default"},onUnblock:function(){b(a.text())}})}function showErrorDialog(a){$.blockUI({message:$(".error-dialog"),timeout:6000,css:a,overlayCSS:{backgroundColor:"#000",opacity:0.6,cursor:"default"}})}function showBlockedErrorMessage(c){var a=getCssForBlockUI("#cb2026");var b=$(".error-dialog-content");b.text(c);showErrorDialog(a)}function showBlockedLoginDialog(){var a=getCssForBlockUI("#fff");$.blockUI({message:$(".login-dialog"),css:a,overlayCSS:{backgroundColor:"#000",opacity:0.92,cursor:"default"}})}function showBlockedInstallDialog(){var a=getCssForBlockUI2("#fff","600px","-300px","fixed","10%");$.blockUI({message:$(".install-dialog"),css:a,overlayCSS:{backgroundColor:"#000",opacity:0.92,cursor:"default"}})}function getCssForBlockUI(a){return getCssForBlockUI2(a,"500px","-250px","fixed","20%")}function getCssForBlockUI2(f,e,d,c,b){var a={position:c,top:b,width:e,left:"50%","margin-left":d,border:"1px solid White","box-shadow":"0 0 25px 5px #999","-moz-box-shadow":"0 0 25px 5px #999","-webkit-box-shadow":"0 0 25px 5px #999",padding:"0px",color:"White",backgroundColor:f,"-webkit-border-radius":"10px","-moz-border-radius":"10px","border-radius":"10px",opacity:0.9,color:"#fff",cursor:"default","font-size":"20px"};if($(window).width()<540){a={position:c,top:b,width:"80%",left:"10%",border:"1px solid White","box-shadow":"0 0 25px 5px #999","-moz-box-shadow":"0 0 25px 5px #999","-webkit-box-shadow":"0 0 25px 5px #999",padding:"0px",color:"White",backgroundColor:f,"-webkit-border-radius":"10px","-moz-border-radius":"10px","border-radius":"10px",opacity:0.99,color:"#fff",cursor:"default","font-size":"20px"}}return a}function dialogs_InitCommons(){$(".error-dialog").live("click",$.unblockUI);$(".dialog-close-button").live("click",$.unblockUI);$(".confirm-dialog").live("click",$.unblockUI);$(".confirm-dialog-btn-yes").live("click",function(){$(this).closest(".confirm-dialog-content").find(".confirm-dialog-result").text("1")});$(".blockOverlay").attr("title","Click to close the error window").live("click",function(){if($(this).next(".blockMsg").find(".strong-modal").length==0){$.unblockUI()}})};function getImageIdFor(c,b){var a=null;$.each(b,function(f,e){var d=$(e).find(".photo-attach-view-id").text();d="[photo-"+d+"]";if(d==c){a=$(e).find(".photo-attach-id").text();return false}});return a}function replaceImageViewIDsWithRealIDs(d,c,e){var a=e.find(".photo-attach-wrp");var b=new RegExp();d=d.replace(/\[photo\-[1-9][0-9]{0,1}\]/gi,function(f){var g=getImageIdFor(f,a);if(g!=null){return"[photo-"+g+"]"}else{return f}});return d}function showHideAddButtonSpinner(b,a){if(a){b.text("");var c=$("#applicationPath").text()+"/Images/spinner.gif";b.html("<img class='act-busy' alt='...' src='"+c+"' /><span>&nbsp;&nbsp;adding...</span>")}else{b.html("");b.text("+ add")}}function entryAddFailedEx(e,c,d,b){return function a(){showBlockedErrorMessage(b);addingEntryFinished(e,c,d)}}function highlightNewEntry(b){var a=b.find(".mb-inner");a.before("<div class='new-entry-highlight'/>");a.prev().width(a.width()).height(a.height()).css({position:"absolute","background-color":"#ffff99",opacity:".7"}).fadeOut(3000)}function entryAddSucceededEx(c,f,d,e,b){return function a(h,x,m,k){if(x=="success"){if(h.ErrorCode=="0"){var q=e.find(".photo-attach-list");q.html("");var i=$(".pageResources");var l=i.find(".entry-block");var y=l.clone();y.find(".entry-id").text(h.Entry.Id);var n=getRootUrl()+"/user/"+h.Entry.CreatedBy;var w=window.location.href.toString();var s=getUrlParameters(w);var o=getSplitId2(s);var r=getGoogleExperimentId2(s);var z="?";if(o>0){n+=z+"split="+o;z="&"}if(r){n+=z+"utm_expid="+r;z="&"}y.find(".user-img-link").attr("href",n);y.find(".user-img").attr("src",h.Entry.AuthorInfo.PhotoUrl);y.find(".entry-delete-mini-btn").removeClass("hidden");y.find(".entry-delete-btn").removeClass("hidden");var g=i.find(".entry-react-list");var p=g.clone();var j=y.find(".reactions-result");j.before(h.Entry.ContentAsEncodedHtml);j.after(p);var v=$(".content");if(b){var t=v.find(".entry-preview-block:first");t.after(y)}else{var u=v.find(".last-add");u.before(y)}if(v.find(".entry-block").length>=3){v.find(".last-add").show().next(".entry-preview-block").show()}$("#topicDelete").hide();addingEntryFinished(f,d,e);f.val("");f.trigger("autosize");f.blur();$("#entryAddEncourageBeFirst").hide().next("#entryAddEncourageNoFirst").show();highlightNewEntry(y)}else{entryAddFailedEx(f,d,e,h.ErrorMessage)()}}else{entryAddFailedEx(f,d,e,"Unknown error occured while saving your entry!")()}}}function addingEntryFinished(d,b,c){b.removeAttr("pressed");showHideAddButtonSpinner(b,false);d.removeAttr("disabled");c.find(".photo-upload-start-btn").removeAttr("disabled");var a=c.find(".photo-attach-list");a.find(".remove-file-btn").removeAttr("disabled","disabled")}function addEntry(n,l,k){k.attr("pressed","pressed");showHideAddButtonSpinner(k,true);l.attr("disabled","disabled");var c=k.prev(".photo-upload-section");c.find(".photo-upload-start-btn").attr("disabled","disabled");var o=c.find(".photo-attach-list");o.find(".remove-file-btn").attr("disabled","disabled");n=replaceImageViewIDsWithRealIDs(n,l,o);var p=k.closest(".mb-inner");var h=p.find(".social-share-wrp");var d=h.find(".social-share-check[value='1']");var e=h.find(".social-share-check[value='2']");var f=false;var m=false;if(d.attr("checked")){f=true}if(e.attr("checked")){m=true}var g=true;if(p.closest(".main-block").hasClass("last-add")){g=false}var i=$("#topicId").text();var j={TopicId:i,Content:n,EntryId:0,ShareOnFacebook:f,ShareOnTwitter:m};var b=JSON.stringify(j);var a=$("#applicationPath").text()+"/svc/rest/topic/entry/new";$.ajax({url:a,type:"POST",dataType:"json",contentType:"application/json",data:b,success:entryAddSucceededEx(j,l,k,c,g),error:entryAddFailedEx(l,k,c,"Unknown error occured while saving your entry!")});_gaq.push(["_trackEvent","ContributionCategory","Entry","Add",1,null])}function startAddingEntry(c){if(c.attr("pressed")){return false}var a=c.closest(".mb-inner");var b=a.find(".entry-add-inp-wrp");var f=b.find(".entry-add-inp");var e=f.attr("value");e=$.trim(e);if(e.length>0){addEntry(e,f,c)}else{var g={borderTopColor:"#cb2026",borderLeftColor:"#cb2026",borderRightColor:"#cb2026",borderBottomColor:"#cb2026"};var d={borderTopColor:"#ccc",borderLeftColor:"#ccc",borderRightColor:"#ccc",borderBottomColor:"#ccc"};f.animate(g,"slow",function(){$(this).stop().animate(d,"fast")})}}function loadingEntriesFinished(){$(".spinner-block").remove()}function loadingEntriesFailedEx(a){return function b(){showBlockedErrorMessage(a);loadingEntriesFinished()}}function loadingEntriesSucceeded(b,p,g,e){if(p=="success"){if(b.ErrorCode=="0"){loadingEntriesFinished();var c=$(".pageResources");var f=c.find(".entry-block");var a=c.find(".entry-react-list");var n=$(".content");var h=n.find(".entry-preview-block:first");var k=getRootUrl()+"/user/";var o=window.location.href.toString();var m=getUrlParameters(o);var i=getSplitId2(m);var l=getGoogleExperimentId2(m);var d="";var q="?";if(i>0){d+=q+"split="+i;q="&"}if(l){d+=q+"utm_expid="+l;q="&"}$.each(b.Entries,function(x,A){var s=f.clone();var v=k+A.CreatedBy+d;s.find(".user-img-link").attr("href",v);s.find(".user-img").attr("src",A.AuthorInfo.PhotoUrl);s.find(".entry-id").text(A.Id);if(A.CanDelete){s.find(".entry-delete-mini-btn").removeClass("hidden");s.find(".entry-delete-btn").removeClass("hidden")}var z=a.clone();var y=s.find(".reactions-result");y.before(A.ContentAsEncodedHtml);y.after(z);var C=y.find(".data-me-current");C.text(A.ReactionSummary.MyReactionsAsText);var w=y.find(".data-all-current");w.text(A.ReactionSummary.TopReactionsAsText);$.each(A.ReactionSummary.MyReactions,function(D,F){var E=z.find(".entry-react[value="+F.toString()+"]");E.attr("pressed","pressed")});var u=s.find(".vote-result");var B=u.find(".data-me-current");B.text(getVoteMsg(A.VotingSummary.MyVote));if(A.VotingSummary.MyVote>0){s.find(".vote[value=1]").attr("pressed","pressed")}else{if(A.VotingSummary.MyVote<0){s.find(".vote[value=-1]").attr("pressed","pressed")}}var t=u.find(".data-all-current");t.text(A.VotingSummary.UpvotePercentageAsText);t.show();h.after(s);h=s});$("#topicInvite").show();if(b.Entries.length>=3){n.find(".last-add").show().next(".entry-preview-block").show()}else{if(b.Entries.length==0){$("#entryAddEncourageBeFirst").show().next("#entryAddEncourageNoFirst").hide();var r=n.find(".entry-add-inp:first");var j=r.text();if($.trim(j).length==0){r.val("\n\n\n");r.trigger("autosize");r.focus()}}}}else{loadingEntriesFailedEx(b.ErrorMessage)()}}else{loadingEntriesFailedEx("Entries couldn't be loaded. Please refresh the page!")()}}function loadInitialEntries(){var c=$("#topicId").text();if(c.length==0){return}$(".spinner-block").show();$(".entry-add:first").show();var b=getEntryIdFromUrl();var a=$("#applicationPath").text()+"/svc/rest/topic/entries/byvote/"+c+"/50/0?e="+b;$.ajax({url:a,type:"POST",dataType:"json",contentType:"application/json",data:null,success:loadingEntriesSucceeded,error:loadingEntriesFailedEx("Entries couldn't be loaded. Please refresh the page!")})}function entryDeleteFailedEx(c,b){return function a(){c.removeAttr("disabled");showBlockedErrorMessage(b)}}function entryDeleteSucceededEx(b,a){return function c(e,f,g,d){if(f=="success"){if(e.ErrorCode=="0"){b.removeAttr("disabled");a.fadeOut("slow",function(){var j=$(this).closest(".content");var i=j.find(".entry-block");if(i.length<=3){j.find(".last-add").hide().next(".entry-preview-block").hide()}if(i.length<=1){if($("#canDeleteIfNoEntry").text()=="1"){$("#topicDelete").show()}$("#entryAddEncourageBeFirst").show().next("#entryAddEncourageNoFirst").hide();var k=j.find(".entry-add-inp:first");var h=k.text();if($.trim(h).length==0){k.val("\n\n\n");k.trigger("autosize");k.focus()}}$(this).remove()})}else{entryDeleteFailedEx(b,e.ErrorMessage)()}}else{entryDeleteFailedEx(b,"Unknown error occured while deleting the entry!")()}}}function deleteEntry(a){if(a.attr("disabled")){return}showBlockedConfirmDialog("Are you sure to delete this entry?",function(f){if(f==1){a.attr("disabled","disabled");var e=$("#topicId").text();var c=a.closest(".main-block");var d=c.find(".entry-id").text();var b=$("#applicationPath").text()+"/svc/rest/topic/entry/mark/"+e+"/"+d+"/delete";$.ajax({url:b,type:"POST",dataType:"json",contentType:"application/json",data:null,success:entryDeleteSucceededEx(a,c),error:entryDeleteFailedEx(a,"Unknown error occured while deleting the entry!")})}})}function loadingRecommendedTopicsSucceeded(d,b,i,k){if(b=="success"){if(d.ErrorCode=="0"){var c=$("#relatedTopicsTitle");if(d.Items.length>0){c.show();var h=c.next(".related");var f=getRootUrl()+"/";var j=window.location.href.toString();var a=getUrlParameters(j);var e=getSplitId2(a);var g=getGoogleExperimentId2(a);$.each(d.Items,function(o,n){var m=f+n.SeoLink;var q="?";if(e>0){m+=q+"split="+e;q="&"}if(g){m+=q+"utm_expid="+g;q="&"}var p="<a href='"+m+"' class='related-topic-link'>"+n.Title+"</a>";var l="<li class='related-topic act txt-lrx'>"+p+" (<span class='topic-entry-count'>"+n.EntryCount+"</span>)<span class='rel-topic-seo-link hidden'>"+n.SeoLink+"</span></li>";h.append(l)})}}else{loadingRecommendedTopicsFailed()}}else{loadingRecommendedTopicsFailed()}}function loadRecommendedTopics(){var b=$("#topicId").text();if(b.length==0){return}var a=$("#applicationPath").text()+"/svc/rest/topic/"+b+"/related";$.ajax({url:a,type:"POST",dataType:"json",contentType:"application/json",data:null,success:loadingRecommendedTopicsSucceeded,error:null})}function getEntryIdFromUrl(){var c=-1;var b=window.location.href.toString();var a=getUrlParameters(b);var d=a.e;if(d!==undefined){if(isInteger(d)){c=parseInt(d)}}return c}function entryPage_Init_AddGetDelete(){$(".entry-add-btn").live("click",function(){if($("#isAuthenticated").text()=="0"){showBlockedLoginDialog();return false}startAddingEntry($(this));return false});$(".entry-delete-btn").live("click",function(){if($("#isAuthenticated").text()=="0"){showBlockedLoginDialog();return false}deleteEntry($(this));return false});$(".entry-delete-mini-btn").live("click",function(){if($("#isAuthenticated").text()=="0"){showBlockedLoginDialog();return false}deleteEntry($(this));return false});loadInitialEntries();loadRecommendedTopics()};function toggleButton(a){if($(a).attr("pressed")){$(a).removeAttr("pressed")}else{$(a).attr("pressed","pressed")}}function toggleExclusiveButton(b){if($(b).attr("pressed")){$(b).removeAttr("pressed")}else{var a=$(b).siblings("button[pressed]");if(a.length>0){a.removeAttr("pressed")}$(b).attr("pressed","pressed")}};function trimTailingNewLine(a){if(a==null){return a}while(a.length>0&&(a[a.length-1]=="\n"||a[a.length-1]=="\r")){a=a.substring(0,a.length-1)}return a}function getImageUrlFor(c,b){var a=null;$.each(b,function(f,e){var d=$(e).find(".photo-attach-view-id").text();d="[photo-"+d+"]";if(d==c){a=$(e).find(".photo-attach-url").text();return false}});return a}function matchNextAndReplace(k,b,i,d){var e=-1;var m=b+b;var f=false;for(var h=0;h<k.length;h++){if(k[h]=="\\"){f=true}else{if(f==true&&k[h]==b){}else{f=false}}if(!f&&h>=1){var a=k.substring(h-1,h+1);if(a==m){if(e<0){e=h-1}else{var c=k.substring(0,e);var l=k.substring(e+2,h-1);var j="";if(h!=k.length-1){j=k.substring(h+1,k.length)}var g=c+i+l+d+j;return g}}}}return k}function matchNextAndReplaceAll(f,c,d,a){var b=true;while(b){var e=matchNextAndReplace(f,c,d,a);if(e!=f){f=e}else{b=false}}return f}function _updatePreviewImages(d,e){var b=d.closest(".mb-inner");var f=b.find(".photo-upload-section");var a=f.find(".photo-attach-wrp");var c=new RegExp();e=e.replace(/\[photo\-[1-9][0-9]{0,1}\]/gi,function(g){var h=getImageUrlFor(g,a);if(h!=null){return"<img class='entry-img-preview' alt='...' src='"+h+"'/>"}else{return g}});return e}function escapeHtmlSpecialChars(a){return $("<div/>").text(a).html()}function detectLinksAndExtract(d,a,b){var c=new RegExp(/((((https?|ftps?)\:\/\/|www\.)[a-zA-Z0-9\-\.]+\.[a-zA-Z]{2,3})|([a-zA-Z0-9\-\.]+\.(com|net|org|info|co|us|me|tv|mil)(\.tr)?))((\/|\?)\S*)?/gi);d=d.replace(c,function(e){var f=escapeHtmlSpecialChars(e);var i=e;if(i.length>35){i=i.substring(0,32);i+="..."}i=escapeHtmlSpecialChars(i);var j=guidGeneratorNoDash();var h=$("#applicationPath").text()+"/Images/link.png";var g="<a class='entry-detected-link' target='_blank' href='javascript:void(0);'>"+i+"<span class='link-data hidden'>"+f+"</span></a><img class='entry-detected-link-img' src='"+h+"' alt='.' />";a.push(j);b.push(g);return j});return d}function _updatePreview(h,i){var d=h.closest(".main-block");var c=d.next(".entry-preview-block");var a=c.find(".entry-preview");if($.trim(i).length>0){var b=new Array();var g=new Array();i=detectLinksAndExtract(i,b,g);i=escapeHtmlSpecialChars(i);i=_updatePreviewImages(h,i);i=matchNextAndReplaceAll(i,"*","<b>","</b>");i=matchNextAndReplaceAll(i,"_","<u>","</u>");var e=guidGeneratorNoDash();i=i.replace(/(https?|ftps?|file)\:\/\//gi,function(j){return j.substring(0,j.length-2)+e});i=matchNextAndReplaceAll(i,"/","<i>","</i>");i=i.replace(new RegExp(e,"gi"),"//");i=matchNextAndReplaceAll(i,"|","<span class='upperCase'>","</span>");for(var f=0;f<b.length;f++){i=i.replace(b[f],g[f])}i=$.trim(i);i=i.replace(new RegExp("\n","gi"),"<br/>");i="<p class='entry-paragraph'>"+i+"</p>";a.html(i);a.show()}else{a.slideUp(400,function(){a.html("")})}}function updatePreview(c){var a=c.data("lastProcessedData");var b=c.attr("value");if(a!=b){_updatePreview(c,b);c.data("lastProcessedData",b)}}function entryPage_Init_Preview(){$(".entry-add-inp").each(function(a,b){setInterval(function(){updatePreview($(b))},300)});$(".entry-detected-link").live("click",function(){var b=$(this).find(".link-data").text();var a=new RegExp(/^(https?|ftps?)/gi);if(!a.test(b)){b="http://"+b}window.open(b,"_blank");return false});$(".entry-detected-link-img").live("click",function(){var c=$(this).prev(".entry-detected-link");if(c!=null&&c!=undefined&&c.length==1){var b=c.find(".link-data").text();var a=new RegExp(/^(https?|ftps?)/gi);if(!a.test(b)){b="http://"+b}window.open(b,"_blank");return false}})};function authStateChanged(d,c,a,b){if(c=="working"){$(".auth-ctrl-none").hide();$(".auth-ctrl-success").hide();$(".auth-ctrl-checking").show()}else{if(c=="success"){$(".auth-ctrl-none").hide();$(".auth-ctrl-checking").hide();$(".auth-ctrl-success").show()}else{if(c=="failure"||c=="cancelled"||c=="logout"){$(".auth-ctrl-checking").hide();$(".auth-ctrl-success").hide();$(".auth-ctrl-none").show()}else{if(c=="server-success"){$(".no-auth-only").hide();$(".auth-only").show()}}}}if(b!=null){b(d,c,a)}}function initFacebook(g,c,e){authStateChanged("Facebook","working",false,c);var a=((document.location.port==80)?"":(":"+document.location.port));var f=document.location.protocol+"//"+document.location.hostname+a+"/channel.html";var b={appId:g,status:false,cookie:false,xfbml:false,channelUrl:f,frictionlessRequests:true};FB.init(b);function d(i){if(i.status==="connected"){var h=$("#isAuthenticated");if(h.length==1){if(h.text()!=i.authResponse.userID){sendClientBasedAuthToServer("Facebook",i.authResponse.userID,i.authResponse.accessToken,i.authResponse.expiresIn,false,c,e)}else{authStateChanged("Facebook","success",false,c)}}else{authStateChanged("Facebook","success",false,c)}}else{if(i.status==="not_authorized"){authStateChanged("Facebook","failure",false,c)}else{authStateChanged("Facebook","failure",false,c)}}}FB.getLoginStatus(d)}function signupToFacebook(a,b){FB.login(function(c){if(c.authResponse){sendClientBasedAuthToServer("Facebook",c.authResponse.userID,c.authResponse.accessToken,c.authResponse.expiresIn,true,a,b)}else{authStateChanged("Facebook","cancelled",true,a)}},{scope:"email, publish_actions"})}function serverAuthFailedEx(e,a,d,c){return function b(){if(a){showBlockedErrorMessage(d)}authStateChanged(e,"failure",a,c)}}function serverAuthSucceededEx(e,a,b,d){return function c(g,j,k,f){if(j=="success"){if(g.ErrorCode=="0"){d(g);authStateChanged(e,"success",a,b);authStateChanged(e,"server-success",a,b)}else{var i=e+" authentication couldn't be verified: "+g.ErrorMessage;serverAuthFailedEx(e,a,i,b)()}}else{var h="An unknown error occuring while verifying your "+e+" authentication";serverAuthFailedEx(e,a,h,b)()}}}function sendClientBasedAuthToServer(h,g,j,a,l,m,d){var e=0;if(h=="Facebook"){e=1}var n=window.location.href.toString();var f=getSplitId(n);var k="An unknown error occuring while verifying your Facebook authentication";var i={OAuthProvider:e,OAuthUserId:g,OAuthAccessToken:j,OAuthExpiresInSeconds:a,SplitId:f};var c=JSON.stringify(i);var b=$("#applicationPath").text()+"/svc/rest/signin";$.ajax({url:b,type:"POST",dataType:"json",contentType:"application/json",data:c,success:serverAuthSucceededEx(h,l,m,d),error:serverAuthFailedEx(h,l,k,m)});return false}function logout(c,a){var b=$("#applicationPath").text()+"/svc/rest/logout";$.ajax({url:b,type:"POST",dataType:"json",contentType:"application/json",data:null,success:function(){FB.logout();authStateChanged("Facebook","logout",a,c)},error:null})}function onServerAuthDefault(a){setCookie("XAuthToken",a.Token,a.ExpiresInSeconds);$("#currentUserName").text(a.UserFriendlyName);$("#currentUserName2").text(a.UserFriendlyName);$("#currentUserPhoto").attr("src",a.PhotoUrl);$("#isAuthenticated").text(a.OAuthUserId)}function onAuthStateChangeDefault(c,b,a){if(b=="success"){$.unblockUI();if(a){_gaq.push(["_trackEvent","SignupCategory","Facebook","Signup",1,null])}}else{if(b=="failure"){if($("#isAuthenticated").text()!="0"){logout(onAuthStateChangeDefault,a)}}else{if(b=="logout"){setCookie("XAuthToken","",-1);$("#isAuthenticated").text("0")}}}}function onAuthStateChanged(k,a,j){if(a=="success"){$.unblockUI();var d=getEntryIdFromUrl();var i=$("#entryComparisonDialogContentIsValid");var b=window.location.href.toString();var f=getHashParameters(b)["f"];if(d>=0&&i.text()==1&&f==1){showBlockedComparisonDialog();i.text("0")}if(j){_gaq.push(["_trackEvent","SignupCategory","Facebook","Signup",1,null])}}else{if(a=="server-success"){$("#content").find(".entry-block").fadeOut("slow",function(){$(this).remove()});loadInitialEntries()}else{if(a=="failure"){if($("#isAuthenticated").text()!="0"){logout(onAuthStateChanged,j)}if(!j){var g=window.location.href.toString();var c=getUrlParameters(g);var e=c.e;if(e!==undefined){var h=-1;if(isInteger(e)){h=parseInt(e)}encourageAppInstall(k,true,h)}}}else{if(a=="logout"){setCookie("XAuthToken","",-1);if($("#isAuthenticated").text()!="0"){$("#facebookFriendSelectArea").html("");$("#content").find(".entry-block").fadeOut("slow",function(){$(this).remove()});loadInitialEntries()}$("#isAuthenticated").text("0")}}}}}function encourageAppInstall(c,b,a){showBlockedInstallDialog()}function printAuthCookie(){var b=1;var a=new RegExp("XAuthToken=[^;]+","gi");alert(document.cookie);document.cookie.replace(a,function(c){var d="";if(c.length<10){d=c}else{d=c.substring(c.length-10,10)}alert(b.toString()+": "+d);b++;return c})}function facebookConnect_Init_DefaultActions(){$(".signup-facebook").live("click",function(){signupToFacebook(onAuthStateChanged,onServerAuthDefault)});$(".signup-modal").live("click",function(){signupToFacebook(onAuthStateChanged,onServerAuthDefault);return false})};function closePhotoUploadSection(e,f){var a=e.find(".photo-upload-start-wrp");var c=a.find(".photo-upload-start-btn");var d=e.find(".photo-upload-input-wrp");var b=e.find(".photo-upload-do-btn");b.removeAttr("_pressed");hideUploadError(b);d.slideUp(400,function(){showHideUploadSpinner(b,false);c.removeAttr("pressed");a.removeAttr("pressed");e.siblings(".entry-add-btn").show();if(f){f()}})}function hideUploadError(c){var b=c.closest("form");var d=b.find(".upload-result");var a=d.find(".upload-result-err");d.slideUp(400,function(){a.text("")})}function showUploadError(c,b){var a=c.find(".upload-result-err");a.text(b);c.slideDown(400)}function showHideUploadSpinner(b,a){if(a){b.text("");var c=$("#applicationPath").text()+"/Images/spinner.gif";b.html("<img class='act-busy' alt='...' src='"+c+"' />")}else{b.html("");b.text("upload")}}function fileUploadFailedEx(f,a,e,d,g,c){return function b(){f.removeAttr("_pressed");showHideUploadSpinner(f,false);if(c!=null&&c!=undefined&&c.length>0){a.find(".photo-upload-input-url").attr("value",c)}if(g==0){var i=a.find(".photo-upload-choice[value='0']");i.click()}else{if(g==1){var h=a.find(".photo-upload-choice[value='1']");h.click()}}showUploadError(e,d)}}function adjustTextAreaCursor(a){var c=false;var b=a.val();if(b.length==0){c=true}else{if(b.indexOf("\n[photo-")==0&&compareHeightTo3Rows(a)==0&&b.lastIndexOf("\n")==(b.length-1)){c=true}}if(c){a[0].setSelectionRange(0,0)}}function _adjustWatermarkDesc(d,a,f){if(a==1||a==2||a==3){var b=d.siblings(".entry-add-inp-dsc");if(a==1){b.attr("value","add your entry")}else{if(a==2){b.attr("value","say something about this photo\n\n")}else{if(a==3){b.attr("value","say something about this photo\n\ntell more about the above photo")}}}var e=d.height();var c=b.height();if(c!=e){b.height(e)}if(f){d.addClass("semi-trans")}}}function adjustWatermarkDescriptionEx(c,b){var a=c.val();if($.trim(a)==""){_adjustWatermarkDesc(c,1,b)}else{if(a.indexOf("\n[photo-")==0){if(compareHeightTo3Rows(c)==0&&a.lastIndexOf("\n")==(a.length-1)){_adjustWatermarkDesc(c,3,b)}else{_adjustWatermarkDesc(c,2,b)}}else{if(compareHeightTo3Rows(c)==-1&&!b){_adjustWatermarkDesc(c,1,b)}else{if(b){c.removeClass("semi-trans")}}}}}function compareHeightTo3Rows(b){var a=b.height();if(a<50){return -1}else{if(a>65){return 1}else{return 0}}}function adjustTextEditorOnUpload(a,i,d){var g=a.closest(".mb-inner");var b=g.find(".entry-add-inp");var e=b.attr("value");var f=e;if($.trim(e).length<=0){if(i.length==0){f="\n"+d+"\n"}else{f="\n"+i.join("\n\n")+"\n\n"+d+"\n"}}else{if(i.length>0){var c=new Array();for(var h=0;h<i.length;h++){if(e.indexOf(i[h])<0){c.push(i[h])}}if(c.length>0){f=trimTailingNewLine(f);f+="\n\n";f+=c.join("\n\n")+"\n"}if(f.indexOf(d)<0){f=trimTailingNewLine(f);f+="\n\n";f+=d+"\n"}}else{if(f.indexOf(d)<0){f=trimTailingNewLine(f);f+="\n\n";f+=d+"\n"}else{f+="\n"}}}b.attr("value",f);b.trigger("autosize")}function fileUploadSucceededEx(e,b,d,f,c){return function a(r,i,t,u){if(i=="success"){var n=sanitizeJsonResponse(r);if(n.ErrorCode==0){var o=$(".pageResources");var l=o.find(".photo-attach-wrp");var q=l.clone();var k=0;var h=u.closest(".photo-upload-section");var j=h.find(".photo-attach-list");var s=new Array();var m=j.find(".photo-attach-wrp");if(m.length>0){$.each(m,function(x,w){var v=$(w).find(".photo-attach-view-id").text();s.push("[photo-"+v+"]");if(x==m.length-1){k=parseInt(v.toString())}})}k++;var g="photo-"+k.toString();q.find(".photo-attach-view-id").text(k.toString());q.find(".photo-attach-id").text(n.FileInfo.Id);q.find(".photo-attach-url").text(n.FileInfo.CloudUrl);q.find(".photo-attach-txt").text(g);j.append(q);var p="["+g+"]";closePhotoUploadSection(h,function(){adjustTextEditorOnUpload(h,s,p)})}else{fileUploadFailedEx(e,u,d,n.ErrorMessage,f,c)()}}else{fileUploadFailedEx(e,u,d,"Unknown error occured",f,c)()}}}function uploadPhoto(g,a,e,h,d){var f=guidGenerator();var c=$("#applicationPath").text()+"/UploadHandlers/FileUpload.ashx?rid="+f;var b={url:c,type:"POST",success:fileUploadSucceededEx(g,a,e,h,d),error:fileUploadFailedEx(g,a,e,"Unknown error occured",h,d),clearForm:true,resetForm:true,dataType:null,data:null,timeout:30*1000};a.ajaxSubmit(b);return false}function startUploadingPhoto(e){var d=e.closest("form");var f=d.find(".upload-result");var a=f.find(".upload-result-err");if(e.attr("_pressed")){return false}var b=null;var g=d.find(".photo-upload-choice:checked").attr("value");if(g==0){b=d.find(".photo-upload-input-url").attr("value");b=$.trim(b);if(b.length<=0){showUploadError(f,"Please enter the web link of the image");return false}}else{if(g==1){var c=$(d[0]["LocalFile"]).val();if(c){if(!checkFileExt(c,__allowedExtensions)){showUploadError(f,"Unsupported file type");return false}}else{showUploadError(f,"Please choose a file");return false}}else{showUploadError(f,"Please choose one of the radio buttons");return false}}e.attr("_pressed","_pressed");showHideUploadSpinner(e,true);uploadPhoto(e,d,f,g,b)}function openOrCloseUploadArea(d){var c=d.closest(".photo-upload-section");if(d.attr("pressed")){var e=c.find(".photo-upload-do-btn");if(!e.attr("_pressed")){closePhotoUploadSection(c)}return false}d.attr("pressed","pressed");d.closest(".photo-upload-start-wrp").attr("pressed","pressed");var b=c.find(".photo-upload-input-wrp");var a=b.find(".photo-upload-input-url");var f=b.find(".photo-upload-choice[value='0']");c.siblings(".entry-add-btn").hide();b.slideDown(400,function(){f.click();a.focus()})}function removeImageFile(h){var c=h.siblings(".photo-attach-id").text();var a=$("#applicationPath").text()+"/svc/rest/image/discard/"+c;$.ajax({url:a,type:"POST",dataType:"json",contentType:"application/json",data:null,success:null,error:null});var e=h.closest(".photo-attach-wrp");var d=e.closest(".mb-inner");var g=e.find(".photo-attach-txt").text();g="["+g+"]";e.remove();var f=d.find(".entry-add-inp");var j=f.attr("value");var i=g.replace(/\[/g,"\\[").replace(/\]/g,"\\]").replace(/\-/g,"\\-");var b=new RegExp(i,"gi");j=j.replace(b,"");if($.trim(j).length==0){j=$.trim(j)}f.attr("value",j);f.trigger("autosize")}function entryPage_Init_ImageUpload(){$(".entry-add-inp").autosize({callback:function(){adjustWatermarkDescriptionEx($(this),false)}});$(".entry-add-inp").live("focus",function(a){adjustTextAreaCursor($(this))});$(".entry-add-inp").live("blur",function(){adjustWatermarkDescriptionEx($(this),true)});$(".entry-add-inp").each(function(a,b){$(this).val("");$.when($(this).trigger("autosize")).done(function(){adjustWatermarkDescriptionEx($(this),true)})});$(".photo-upload-input").live("focus",function(){hideUploadError($(this));return false});$(".photo-upload-do-btn").live("click",function(){if($("#isAuthenticated").text()=="0"){showBlockedLoginDialog();return false}startUploadingPhoto($(this));return false});$(".photo-upload-start-btn").live("click",function(){openOrCloseUploadArea($(this));return false});$(".cancel-upload-btn").live("click",function(){var a=$(this).closest(".photo-upload-section");closePhotoUploadSection(a);return false});$(".remove-file-btn").live("click",function(){removeImageFile($(this));return false});$(".photo-upload-choice").live("change",function(){var d=$(this).attr("value");var b=$(this).parent();var a=b.find(".photo-upload-input-url");var c=b.find(".photo-upload-input-file");if(d==0){c.hide();a.show().focus()}else{if(d==1){a.hide();c.show().focus()}}})};function gotoTopics(){var f=getRootUrl()+"/latest";var c=window.location.href.toString();var a=getUrlParameters(c);var e=getSplitId2(a);var b=getGoogleExperimentId2(a);var d="?";if(e>0){f+=d+"split="+e;d="&"}if(b){f+=d+"utm_expid="+b;d="&"}window.location=f}function menu_Init(a){$(".tb-login-success").live("mouseenter",function(){$(this).find(".user-menu").slideDown(200);if(!$(this).hasClass("tb-login-success-mini")){var b=$("#helper");if(b.length>0){b.addClass("helper-transparent")}}});$(".tb-login-success").live("mouseleave",function(){$(this).find(".user-menu").slideUp(200,function(){if(!$(this).hasClass("tb-login-success-mini")){var b=$("#helper");if(b.length>0){b.removeClass("helper-transparent")}}})});$(".tb-login-none-mini").live("mouseenter",function(){$(this).find(".user-menu").slideDown(200)});$(".tb-login-none-mini").live("mouseleave",function(){$(this).find(".user-menu").slideUp(200,function(){})});$(".logout").live("click",function(){logout(a,true)});$(".txt-logo").live("click",function(){gotoTopics()})};function reactingFinished(b){var a=$(b).closest(".main-block");a.find(".entry-react").removeAttr("disabled")}function reactingFailedEx(d,a,b,c){return function e(){var f=$(b).find(".act-done");f.text(c);f.show("fast","linear",function(){$(this).fadeOut(2000,function(){var g=$(b).find(".data-me-current");g.show();var h=b.find(".data-all-current");h.show();reactingFinished(d)})})}}function reactingSucceededEx(d,a,b){return function c(g,j,l,f){var i=$(b).find(".act-busy");i.hide();if(j=="success"){if(g.ErrorCode=="0"){var e=$(b).find(".data-me-current");e.text(g.ReactionSummary.MyReactionsAsText);if(g.ReactionSummary.MyReactionsAsText.length!=0){e.show()}var h=b.find(".data-all-current");if(g.ReactionSummary.TopReactionsAsText.length!=0){h.text(g.ReactionSummary.TopReactionsAsText);h.show()}else{h.text("");h.hide()}toggleButton(d);reactingFinished(d);var k=$(b).find(".act-done");if(a>0){k.text("Updated successfully!")}else{k.text("Reverted successfully!")}k.show("fast","linear",function(){$(this).fadeOut(1500,function(){if(a<0){e.show()}})})}else{reactingFailedEx(d,a,b,g.ErrorMessage)()}}else{reactingFailedEx(d,a,b,"Unknown error occured while saving your reaction!")()}}}function sendReaction(b,f){if($(b).attr("disabled")){return}var j=$(b).closest(".main-block");j.find(".entry-react").attr("disabled","disabled");var k=j.find(".reactions-result");var g=k.find(".data-me-current");var d=k.find(".act-busy");g.hide();d.show();var h=$("#topicId").text();var e=$(b).closest(".main-block").find(".entry-id").text();var a=$("#applicationPath").text()+"/svc/rest/react/"+h+"/"+e+"/"+f;var i=null;var c=JSON.stringify(i);$.ajax({url:a,type:"POST",dataType:"json",contentType:"application/json",data:c,success:reactingSucceededEx(b,f,k),error:reactingFailedEx(b,f,k,"Unknown error occured while saving your reaction!")});if(f>0){_gaq.push(["_trackEvent","QuickInteractCategory","React","Reaction_"+f.toString(),1,null])}}function entryPage_Init_Reacting(){$(".entry-react").live("click",function(){if($("#isAuthenticated").text()=="0"){showBlockedLoginDialog();return false}var c=$(this).val().toString();var a=parseInt(c);var b=$(this).attr("pressed");if(b){a*=-1}sendReaction(this,a);return false})};function sharingOnFacebookCallbackEx(b,a){return function c(d){if(d&&d.post_id){var e=$("#applicationPath").text()+"/svc/rest/topic/entry/log/share/"+b+"/"+a+"/Facebook";$.ajax({url:e,type:"POST",dataType:"json",contentType:"application/json",data:null,success:null,error:null});_gaq.push(["_trackEvent","QuickInteractCategory","Post","Facebook",1,null])}}}function shareEntryOnFacebook(i){var g=$("#topicTitle").text();var j=$("#topicId").text();var c=i.closest(".main-block");var d=c.find(".entry-id").text();var k=c.find(".entry-paragraph");var a=k.text();var f=k.find(".entry-img-preview:first");var h=null;if(f.length>0){h=f.attr("src")}else{h=getRootUrl()+"/Images/logo.png?version=0.8"}var b=window.location.toString();b=removeSplitParams(b);b=removeGoogleExperimentParams(b);b=updateQueryStringParameter(b,"e",d);b=updateHashStringParameter(b,"f","1");var e={method:"feed",name:g,link:b,picture:h,caption:"vizibuzz.com",description:a};FB.ui(e,sharingOnFacebookCallbackEx(j,d))}function shareEntryOnTwitter(k){var i=$("#topicTitle").text();var l=$("#topicId").text();var g=k.closest(".main-block");var h=g.find(".entry-id").text();var p=g.find(".entry-paragraph");var a=p.text();var b=i+" - "+a;var e=window.location.toString();e=removeSplitParams(e);e=removeGoogleExperimentParams(e);e=updateQueryStringParameter(e,"e",h);e=updateHashStringParameter(e,"f","1");e=encodeURIComponent(e);var j=140-22-1;if(b.length>j){b=b.substring(0,j-3)+"..."}var n="http://www.twitter.com/share?url="+e+"&text="+encodeURIComponent(b);var d=480;var o=300;var f=($(window).width()-d)/2;var m=($(window).height()-o)/2;opts="status=1,width="+d+",height="+o+",top="+m+",left="+f;window.open(n,"_blank",opts);var c=$("#applicationPath").text()+"/svc/rest/topic/entry/log/share/"+l+"/"+h+"/Twitter";$.ajax({url:c,type:"POST",dataType:"json",contentType:"application/json",data:null,success:null,error:null});_gaq.push(["_trackEvent","QuickInteractCategory","Post","Twitter",1,null])}function savingTopicInvitationSucceededEx(d,c,b,e){return function a(g,h,i,f){if(h=="success"){if(g.ErrorCode=="0"){if(e==b.length){$(".invite-friends-to-topic").text("Invite More Friends")}}}}}function fbInvitationSentEx(d,c,b,e){return function a(f){if(f){if(f.to.length>0){e=e+f.to.length;if(f.request>0){var h=f.request.toString()+"/"+f.to.length.toString();var g=$("#applicationPath").text()+"/svc/rest/topic/invitation/"+d+"/"+c+"/"+h;$.ajax({url:g,type:"POST",dataType:"json",contentType:"application/json",data:null,success:savingTopicInvitationSucceededEx(d,c,b,e),error:null})}if(e<b.length){showInvitationSendWindow(d,c,b,e)}_gaq.push(["_trackEvent","InviteFriendsCategory","Invite","Facebook",f.to.length,null])}}}}function showInvitationSendWindow(c,b,a,f){if(a.length>f){var e=a.length-f;if(e>MAX_APP_REQUEST_RECIPIENTS){e=MAX_APP_REQUEST_RECIPIENTS}var d=a.slice(f,f+e);FB.ui({method:"apprequests",message:"I believe you can shed some light on this topic!",to:d,data:c},fbInvitationSentEx(c,b,a,f))}}function fbInvitationConfirmed(b,e,d){var a=[];var c=$("#facebookFriendSelectArea");c.find(".ff-cbox[checked='checked']").each(function(f,g){a.push($(g).val())});if(a.length==0){alert("please select at least one friend");return false}b.dialog("close");showInvitationSendWindow(e,d,a,0)}function fbInvitationCancelled(a,c,b){a.dialog("close")}function showFacebookDialogue(b,f,e,c,d){if($(window).width()<540){d="90%"}var a=b.dialog({autoOpen:false,modal:true,draggable:true,resizable:false,bgiframe:true,width:d});b.dialog("option","title",c);b.dialog({buttons:{SendRequests:{text:"Send Requests","class":"facebookInviteButton",click:function(){fbInvitationConfirmed($(this),f,e)}},Cancel:{text:"Cancel","class":"facebookInviteButton facebookInviteCancelButtonClass",click:function(){fbInvitationCancelled($(this),f,e)}}}});b.dialog("open")}function retrieveFacebookFriends(h,f,e,b,a){if(h){h.find(".invite-friends-to-topic").text("Please wait...")}var d="590px";if(!b){d="530px"}var g=$("#customFacebookDialog");var c=g.find("#facebookFriendSelectArea");var j=c.find(".ff-wrp");if(j.length>0){g.find("#facebookFriendsShowOnlySelecteds").removeClass("facebookFriendsCurrentFilter");g.find("#facebookFriendsShowAll").addClass("facebookFriendsCurrentFilter");g.find("#facebookFriendsSelectAllCBox").removeAttr("checked");var i=g.find("#facebookFriendSearchTextBox");i.val("");i.addClass("ffs-watermark");j.show().find(".ff-cbox").removeAttr("checked");showFacebookDialogue(g,f,e,a,d);if(h){h.find(".invite-friends-to-topic").text("Invite your friends to the discussion!")}}else{FB.api("/me/friends?fields=id,name,picture",function(m){if(m&&m.data&&m.data.length>0){for(var o=0;o<m.data.length;o++){var p=m.data[o];var q="<input class='ff-cbox' type='checkbox' name='friends' value='"+p.id+"' />";var n="<div class='ff-name'>"+p.name+"</div>";var k=$("<div />",{id:"ff_"+p.id,"class":"ff-wrp"});if(b){var l="<img alt='' class='ff-img' src='"+p.picture.data.url+"' />";k.html(q+l+n)}else{k.html(q+n)}c.append(k)}showFacebookDialogue(g,f,e,a,d)}if(h){h.find(".invite-friends-to-topic").text("Invite your friends to the discussion!")}})}}function inviteFriendsToTopic(b){var a=$("#topicId").text();retrieveFacebookFriends(b,a,0,true,"Facebook - Invite Friends")}function entryPage_Init_Sharing(){$(".ff-cbox").live("click",function(){if($(this).attr("checked")){$(this).removeAttr("checked")}else{$(this).attr("checked","checked")}});$(".ff-wrp").live("click",function(){var a=$(this).find("input");if(a.attr("checked")){a.removeAttr("checked")}else{a.attr("checked","checked")}});$("#facebookFriendsSelectAllCBox").live("click",function(){var b=false;if($(this).attr("checked")){b=true}var a=$("#facebookFriendSelectArea");a.find(".ff-cbox:visible").each(function(c,d){if(b){$(d).attr("checked","checked")}else{$(d).removeAttr("checked")}})});$("#facebookFriendsShowOnlySelecteds").live("click",function(){$("#facebookFriendsShowAll").removeClass("facebookFriendsCurrentFilter");$(this).addClass("facebookFriendsCurrentFilter");var b=$(this).closest("#customFacebookDialog");var c=b.find("#facebookFriendSearchTextBox");c.val("");c.addClass("ffs-watermark");var a=b.find("#facebookFriendSelectArea");a.find(".ff-wrp").each(function(d,e){if($(e).find(".ff-cbox").attr("checked")){$(e).show()}else{$(e).hide()}})});$("#facebookFriendsShowAll").live("click",function(){$("#facebookFriendsShowOnlySelecteds").removeClass("facebookFriendsCurrentFilter");$(this).addClass("facebookFriendsCurrentFilter");var c=$(this).closest("#customFacebookDialog");var d=c.find("#facebookFriendSearchTextBox");d.val("");d.addClass("ffs-watermark");var b=c.find("#facebookFriendSelectArea");var a=b.find(".ff-wrp");a.show()});$("#facebookFriendSearchTextBox").live("blur",function(){if($.trim($(this).val())==""){$(this).addClass("ffs-watermark")}else{$(this).removeClass("ffs-watermark")}});$("#facebookFriendSearchTextBox").live("keyup",function(){var a=$.trim($(this).val()).toUpperCase();var b=$("#facebookFriendSelectArea");if(a.length==0){b.find(".ff-wrp").show()}else{var c=$("#facebookFriendsShowOnlySelecteds");if(c.hasClass("facebookFriendsCurrentFilter")){c.removeClass("facebookFriendsCurrentFilter");$("#facebookFriendsShowAll").addClass("facebookFriendsCurrentFilter")}b.find(".ff-wrp").each(function(d,e){if($(e).find(".ff-name").text().toUpperCase().indexOf(a)<0){$(e).hide()}else{$(e).show()}})}});$(".btn-share-entry-facebook").live("click",function(){shareEntryOnFacebook($(this));return false});$(".btn-share-entry-twitter").live("click",function(){shareEntryOnTwitter($(this));return false});$(".topic-invite").live("click",function(){if($("#isAuthenticated").text()=="0"){showBlockedLoginDialog();return false}inviteFriendsToTopic($(this));return false})};function applyClientSideSplitters(){var a=$("#splitResources");if(a.length>0){a.find(".splitResourceItem").each(function(b,e){var c=$(e).find(".splitResourceSelector:first").text();var d=$(e).find(".splitResourceFeed:first").text();$(c).each(function(f,g){$(g).html(d)})})}};function topicsFacebookConnectInit(){$(".signup-facebook").live("click",function(){signupToFacebook(onAuthStateChangeDefault,onServerAuthDefault)});$(".signup-modal").live("click",function(){signupToFacebook(onAuthStateChangeDefault,onServerAuthDefault);return false})}function topics_sharingTopicOnFacebookCallbackEx(c,b){return function a(d){if(d&&d.post_id){var e=$("#applicationPath").text()+"/svc/rest/topic/entry/log/share/"+c+"/0/Facebook";$.ajax({url:e,type:"POST",dataType:"json",contentType:"application/json",data:null,success:null,error:null});_gaq.push(["_trackEvent","QuickInteractCategory","Post","Facebook",1,null])}}}function topics_shareTopicOnFacebook(h){var f=h.find("a.topic-link");var c=f.text();var d=h.find(".topic-id").text();var b=h.find(".topic-seo-plain").text();var a=getRootUrl()+"/"+b+"?e=0#f=1";var g=getRootUrl()+"/Images/logo.png?version=0.8";var e={method:"feed",name:c,link:a,picture:g,caption:"vizibuzz.com"};FB.ui(e,topics_sharingTopicOnFacebookCallbackEx(d,0))}function topics_shareTopicOnTwitter(m){var k=m.find("a.topic-link");var f=k.text();var h=m.find(".topic-id").text();var a=m.find(".topic-seo-plain").text();var d=getRootUrl()+"/"+a+"?e=0#f=1";d=encodeURIComponent(d);var g=140-22-1;if(f.length>g){f=f.substring(0,g-3)+"..."}var j="http://www.twitter.com/share?url="+d+"&text="+encodeURIComponent(f);var c=480;var l=300;var e=($(window).width()-c)/2;var i=($(window).height()-l)/2;opts="status=1,width="+c+",height="+l+",top="+i+",left="+e;window.open(j,"_blank",opts);var b=$("#applicationPath").text()+"/svc/rest/topic/entry/log/share/"+h+"/0/Twitter";$.ajax({url:b,type:"POST",dataType:"json",contentType:"application/json",data:null,success:null,error:null});_gaq.push(["_trackEvent","QuickInteractCategory","Post","Twitter",1,null])}function topicPage_Init(){$(".topic-link").live("click",function(){var a=$(this).attr("href");if(a){window.open(a,"_blank")}return false});$(".topic-box").live("click",function(){var a=$(this).find("a.topic-link").attr("href");if(a){window.open(a,"_blank")}return false});$(".topic-box").live("mouseover",function(){var a=$(this).find(".social-mini").removeClass("hidden");return false});$(".topic-box").live("mouseleave",function(){var a=$(this).find(".social-mini").addClass("hidden");return false});$(".facebook-icon-wrp-mini").live("click",function(){var a=$(this).closest(".topic-box");topics_shareTopicOnFacebook(a);return false});$(".twitter-icon-wrp-mini").live("click",function(){var a=$(this).closest(".topic-box");topics_shareTopicOnTwitter(a);return false});$("a.entry-writer").live("click",function(){var a=$(this).attr("href");if(a){window.open(a,"_blank")}return false});$("a.user-img-link").live("click",function(){var a=$(this).attr("href");if(a){window.open(a,"_blank")}return false});$(".promoted-topic-link").live("click",function(){var b=$(this).attr("href");var c=$("#applicationPath").text()+"/"+b;var e=window.location.href.toString();var a=getUrlParameters(e);var g=getSplitId2(a);var f="?";if(g>0){c+=f+"split="+g;f="&"}var d=getGoogleExperimentId2(a);if(d){c+=f+"utm_expid="+d;f="&"}window.open(c,"_blank");return false})};function autoCompleteSearchSucceededEx(b,c){return function a(g,j,k,f){if(j=="success"){if(g.ErrorCode=="0"){var h=0;var d=new Array();var e=true;var i=b.toLowerCase();$.each(g.Topics,function(m,l){d[h++]={label:l.Title,value:l.Title,objectLink:l.SeoLink,objectId:l.Id};if(i==l.Title.toLowerCase()){e=false}});if(g.Topics.length<=0){d[h++]={label:"No result found",value:b,objectId:-200}}if(e){d[h++]={label:"Add New",value:b,objectId:-100}}c(d)}else{c([])}}else{c([])}}}function autoCompleteSearchTopic(d,c){if(_lastTopicSearchQuery!=null){_lastTopicSearchQuery.abort()}var a=d.term;a=$.trim(a);if(a.length<=2){return false}var b=$("#applicationPath").text()+"/svc/rest/topic/search/"+a;b=encodeURI(b);_lastTopicSearchQuery=$.ajax({url:b,type:"POST",dataType:"json",contentType:"application/json",data:null,success:autoCompleteSearchSucceededEx(a,c),error:null})}function renderAutoCompleteItem(a,b){if(b.objectId==-100){return $("<li class='ui-menu-item ui-add-new'></li>").data("item.autocomplete",b).append("<a><span class='search-add-new-txt'>"+b.value+"</span><button class='rnd-crn search-add-new-btn'>+ add this topic</button></a>").appendTo(a)}else{if(b.objectId==-200){return $("<li class='ui-menu-item'></li>").data("item.autocomplete",b).append("<a><span class='search-no-result'>No result found</span></a>").appendTo(a)}}return $("<li class='ui-menu-item'></li>").data("item.autocomplete",b).append("<a>"+b.label+"</a>").appendTo(a)}function autoCompleteItemFocused(b,c){var a=$(".ui-autocomplete").find(".ui-menu-item");a.removeClass("ui-state-focus");$.each(a,function(d,e){var f=$(e).data();if(f.uiAutocompleteItem.objectId==c.item.objectId){$(e).addClass("ui-state-focus")}})}function topicAddFailedEx(b){return function a(){$.unblockUI();showBlockedErrorMessage(b)}}function topicAddSucceededEx(b){return function a(g,f,j,l){if(f=="success"){if(g.ErrorCode=="0"){$.unblockUI();var c=$("#applicationPath").text()+"/"+g.Data.SeoLink;var k=window.location.href.toString();var e=getUrlParameters(k);var h=getSplitId2(e);var d="?";if(h>0){c+=d+"split="+h;d="&"}var i=getGoogleExperimentId2(e);if(i){c+=d+"utm_expid="+i;d="&"}window.location=c}else{topicAddFailedEx(g.ErrorMessage)()}}else{topicAddFailedEx("Unknown error occured while creating the topic!")()}}}function sendAddTopicRequest(b,d,f){var c={Title:b,Id:0,ShareOnFacebook:d,ShareOnTwitter:f};var e=JSON.stringify(c);var a=$("#applicationPath").text()+"/svc/rest/topic/new";$.ajax({url:a,type:"POST",dataType:"json",contentType:"application/json",data:e,success:topicAddSucceededEx(c),error:topicAddFailedEx("Unknown error occured while creating the topic!")});_gaq.push(["_trackEvent","ContributionCategory","Topic","Add",1,null])}function autoCompleteItemSelectedTopic(d,e){if(e.item!=null){if(e.item.objectId>0){var b=$("#applicationPath").text()+"/"+e.item.objectLink;var f=window.location.href.toString();var a=getUrlParameters(f);var h=getSplitId2(a);var g="?";if(h>0){b+=g+"split="+h;g="&"}var c=getGoogleExperimentId2(a);if(c){b+=g+"utm_expid="+c;g="&"}window.location=b}else{if(e.item.objectId==-100){if($("#isAuthenticated").text()=="0"){showBlockedLoginDialog();return}showNewTopicDialog(e.item.value)}}}}function watermarkOnBlur(a){if($(a).val()==""){$(a).addClass("semi-trans")}else{$(a).removeClass("semi-trans")}}function topicDeleteFailedEx(a){return function b(){showBlockedErrorMessage(a)}}function topicDeleteSucceeded(e,d,h,j){if(d=="success"){if(e.ErrorCode=="0"){var a=getRootUrl()+"/latest";var i=window.location.href.toString();var c=getUrlParameters(i);var f=getSplitId2(c);var b="?";if(f>0){a+=b+"split="+f;b="&"}var g=getGoogleExperimentId2(c);if(g){a+=b+"utm_expid="+g;b="&"}window.location=a}else{topicDeleteFailedEx(e.ErrorMessage)()}}else{topicDeleteFailedEx("Unknown error occured while deleting the topic!")()}}function deleteTopic(){showBlockedConfirmDialog("Are you sure to delete this topic?",function(c){if(c==1){var b=$("#topicId").text();var a=$("#applicationPath").text()+"/svc/rest/topic/mark/"+b+"/delete";$.ajax({url:a,type:"POST",dataType:"json",contentType:"application/json",data:null,success:topicDeleteSucceeded,error:topicDeleteFailedEx("Unknown error occured while deleting the topic!")})}})}function showNewTopicDialog(b){$("#newTopicInput").val(b);$("#newTopicDialogResult").text("-1");var a=getCssForBlockUI("#fff");$.blockUI({message:$("#newTopicDialog"),css:a,overlayCSS:{backgroundColor:"#000",opacity:0.8,cursor:"default"}})}function entryPage_Init_TopicSearchAddDelete(){var a={select:autoCompleteItemSelectedTopic,source:autoCompleteSearchTopic,focus:autoCompleteItemFocused};$("#searchTopicBox").autocomplete(a).data("autocomplete")._renderItem=renderAutoCompleteItem;$("#searchTopicBox").live("blur",function(){watermarkOnBlur(this)});$("#newTopicAddBtn").live("click",function(){var c=$("#newTopicInput").val();c=$.trim(c);if(c.length>0){var g=$(this).closest(".dialog");var b=g.find(".social-share-check[value='1']");var f=g.find(".social-share-check[value='2']");var d=false;var e=false;if(b.attr("checked")){d=true}if(f.attr("checked")){e=true}sendAddTopicRequest(c,d,e)}return false});$("#topicDelete").live("click",function(){if($("#isAuthenticated").text()=="0"){showBlockedLoginDialog();return false}deleteTopic();return false})};function getRootUrl(){var a=window.location.protocol+"//"+window.location.host;return a}function updateQueryStringParameter(f,d,g){var b="";var c=f.indexOf("#");if(c>=0){b="#"+getHashPart(f);f=f.substring(0,c)}var e=new RegExp("([?|&])"+d+"(=.*)?(&|$)","i");if(f.match(e)){f=f.replace(e,"$1"+d+"="+g+"$3")}else{var h="&";var a=f.indexOf("?");if(a>=0){if(f[f.length-1]=="?"){h=""}if(f[f.length-1]=="&"){h=""}}else{h="?"}f=f+h+d+"="+g}if(b){f=f+b}return f}function getUrlParameters(c){var f=[];var b=c.indexOf("?");if(b>=0){c=c.slice(b+1);b=c.indexOf("#");if(b>=0){c=c.substring(0,b)}var e=[];var a=c.split("&");for(var d=0;d<a.length;d++){e=a[d].split("=");f.push(e[0]);if(e.length>1){f[e[0]]=e[1]}else{f[e[0]]=undefined}}}return f}function removeUrlParameter(b,e){var a="";var c=b.indexOf("#");if(c>=0){a="#"+getHashPart(b);b=b.substring(0,c)}var d=new RegExp("([?|&])"+e+"(=.*)?(&|$)","i");if(b.match(d)){if("$1"=="?"){b=b.replace(d,"$1$3")}else{b=b.replace(d,"$3")}}b=b.replace("?&","?");if(b.length>0&&b[b.length-1]=="&"){b=b.substring(0,b.length-1)}if(b.length>0&&b[b.length-1]=="?"){b=b.substring(0,b.length-1)}if(a){b=b+a}return b}function removeSplitParams(a){a=removeUrlParameter(a,"split");return a}function removeGoogleExperimentParams(a){a=removeUrlParameter(a,"utm_expid");a=removeUrlParameter(a,"utm_referrer");return a}function getGoogleExperimentId(b){var a=getUrlParameters(b);return getGoogleExperimentId2(a)}function getGoogleExperimentId2(a){return a.utm_expid}function getSplitId(b){var a=getUrlParameters(b);return getSplitId2(a)}function getSplitId2(a){var c=0;var b=a.split;if(b&&isInteger(b)){c=parseInt(b)}return c}function updateHashStringParameter(e,c,f){var h=e;var b=e.indexOf("#");if(b>=0){h=e.substring(0,b)}var a=getHashPart(e);if(a){a="#"+a;var d=new RegExp("([#|&])"+c+"(=.*)?(&|$)","i");if(a.match(d)){a=a.replace(d,"$1"+c+"="+f+"$3")}else{var g=a.indexOf("#")!==-1?"&":"#";a=a+g+c+"="+f}}else{a="#"+c+"="+f}return h+a}function getHashParameters(d){var f=[];var b=d.indexOf("?");if(b>=0){d=d.slice(b+1)}b=d.indexOf("#");if(b>=0){d=d.slice(b+1);if(d){var e=[];var a=d.split("&");for(var c=0;c<a.length;c++){e=a[c].split("=");if(e[0]){f.push(e[0]);if(e.length>1){f[e[0]]=e[1]}else{f[e[0]]=undefined}}}}}return f}function getHashPart(c){var b="";var a=getHashParameters(c);for(var d=0;d<a.length;d++){if(a[a[d]]){b+=a[d]+"="+a[a[d]]+"&"}else{b+=a[d]+"&"}}if(b){if(b[b.length-1]=="&"){b=b.substring(0,b.length-1)}}return b}function removeHashFromUrl(c){var b=window.location.href.toString();b=removeHash(b,c);var a=getHashPart(b);window.location.hash=a}function removeHash(d,g){var c=d.indexOf("#");if(c<0){return d}var f=d.substring(0,c);var b="";var a=getHashParameters(d);for(var e=0;e<a.length;e++){if(g!=a[e]){if(a[a[e]]){b+=a[e]+"="+a[a[e]]+"&"}else{b+=a[e]+"&"}}}if(b){if(b[b.length-1]=="&"){b=b.substring(0,b.length-1)}f+="#"+b}return f};function userActivitiesFacebookConnectInit(){$(".signup-facebook").live("click",function(){signupToFacebook(onAuthStateChangeDefault,onServerAuthDefault)});$(".signup-modal").live("click",function(){signupToFacebook(onAuthStateChangeDefault,onServerAuthDefault);return false})}function userActivitiesPage_Init(){$(".act-log-action-data").live("click",function(){var a=$(this).closest("tr").find("td.act-log-data").find(".act-log-data-link").text();if(a){window.open(a,"_blank");return false}})};function getVoteMsg(a){if(a>0){return"Your vote: +1"}else{if(a<0){return"Your vote: -1"}}return"You haven't voted yet!"}function voteFinished(b){var a=$(b).closest(".main-block");a.find(".vote").removeAttr("disabled")}function voteFailedEx(d,c,a,b){return function e(){var f=$(a).find(".act-done");f.text(b);f.show("fast","linear",function(){$(this).fadeOut(2000,function(){var g=$(a).find(".data-me-current");g.show();var h=a.find(".data-all-current");h.show();voteFinished(d)})})}}function voteSucceededEx(d,c,b){return function a(g,j,l,f){var i=$(b).find(".act-busy");i.hide();if(j=="success"){if(g.ErrorCode=="0"){var e=$(b).find(".data-me-current");e.text(getVoteMsg(g.VotingSummary.MyVote));if(g.VotingSummary.MyVote!=0){e.show()}var h=b.find(".data-all-current");h.text(g.VotingSummary.UpvotePercentageAsText);toggleExclusiveButton(d);voteFinished(d);var k=$(b).find(".act-done");if(g.VotingSummary.MyVote!=0){k.text("Sent successfully!")}else{k.text("Reverted successfully!")}k.show("fast","linear",function(){$(this).fadeOut(1500,function(){if(g.VotingSummary.MyVote==0){e.show()}})})}else{voteFailedEx(d,c,b,g.ErrorMessage)()}}else{voteFailedEx(d,c,b,"Unknown error occured while saving your vote!")()}}}function sendVote(b,g){if($(b).attr("disabled")){return}var j=$(b).closest(".main-block");j.find(".vote").attr("disabled","disabled");var k=j.find(".vote-result");var f=k.find(".data-me-current");var d=k.find(".act-busy");f.hide();d.show();var h=$("#topicId").text();var e=j.find(".entry-id").text();var a=$("#applicationPath").text()+"/svc/rest/vote/"+h+"/"+e+"/"+g;var i=null;var c=JSON.stringify(i);$.ajax({url:a,type:"POST",dataType:"json",contentType:"application/json",data:c,success:voteSucceededEx(b,g,k),error:voteFailedEx(b,g,k,"Unknown error occured while saving your vote!")});if(g!=0){var l="Upvote";if(g<0){l="Downvote"}_gaq.push(["_trackEvent","QuickInteractCategory","Vote",l,1,null])}}function sendComparisonVote(d,c){var a=$(d).closest(".main-block");var g=a.find(".random-topic-id").text();var f=a.find(".entry-id").text();var b=$("#applicationPath").text()+"/svc/rest/vote/"+g+"/"+f+"/"+c;var e=null;var h=JSON.stringify(e);$.ajax({url:b,type:"POST",dataType:"json",contentType:"application/json",data:h,success:null,error:null})}function showBlockedComparisonDialog(){var h=$(".compare-entries-dlg").clone();var c=$("#currentUserName").text();var i="Hey "+c+", help us to pick the BETTER one!";var b=window.location.href.toString();var a=getHashParameters(b);var j=a.u;var e=a.n;var f=a.p;if(e&&f){e=decodeURIComponent(e);f=decodeURIComponent(f);i=e+': "Hey '+c+', which one is BETTER?"';var d=h.find(".comparison-invite-sender-img");d.attr("src",f);d.show()}else{if(e&&j){e=decodeURIComponent(e);i=e+': "Hey '+c+', which one is BETTER?"';var d=h.find(".comparison-invite-sender-img");var f="https://graph.facebook.com/"+j+"/picture?type=small";d.attr("src",f);d.show()}}h.find(".comparison-title").text(i);var g=getCssForBlockUI2("#fff","80%","-40%","absolute","5%");$.blockUI({message:h,css:g,overlayCSS:{backgroundColor:"#000",opacity:0.92,cursor:"default"},onBlock:function(){if($(window).width()>=540){equateHeights($(this),".entry-compare");equateHeights($(this),".topic-word-comparison")}}})}function entryPage_Init_Voting(){$(".vote").live("click",function(){if($("#isAuthenticated").text()=="0"){showBlockedLoginDialog();return false}var b=$(this).val().toString();var f=parseInt(b);if($(this).hasClass("vote-compare")){sendComparisonVote(this,f);var a=window.location.href.toString();a=removeHash(a,"f");a=removeHash(a,"u");a=removeHash(a,"n");a=removeHash(a,"p");var g=getHashPart(a);window.location.hash=g;$.unblockUI();var i="Facebook - Invite Friends";if($(window).width()>540){i="Facebook - Select ALL Friends to send your PICK to!"}var e=$(this).closest(".main-block");var h=e.find(".random-topic-id").text();var d=e.find(".entry-id").text();retrieveFacebookFriends(null,h,d,true,i);_gaq.push(["_trackEvent","VoteUponCompareCategory","Vote","Upvote",1,null])}else{var c=$(this).attr("pressed");if(c){f=0}sendVote(this,f)}return false})};